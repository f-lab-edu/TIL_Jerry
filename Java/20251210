[개요]
- 첫 멘토링 실시. 자바의 신을 활용한 질의 응답이 이루어졌는데, 단 한 개도 똑바로 된 대답을 하지 못하는 대참사가 발생.
- 다음주의 질의를 대비하기 위해 질문 받았던 내용을 기반으로 나만의 답을 정리해놓으려함

[질문 정리]
•  자바에서 객체가 상태를 갖는 것이 어떤 사이드 이펙트를 만들어낼 수 있나요?
> 테스트와 디버깅의 난이도 증가
상태를 가진다는 것은 Setter 등의 수정자를 통해서 변경이 가능하다는 점.
이렇게 변경이 된다는 것은 다른 누군가가 수정을 진행할 수 있다는 점을 의미.
같은 입력을 주어도 값이 달라질 수 있어서 단위 테스트 등이 불안정해지고, 추적이 어려워 디버깅이 어려워진다.
> 만약 멀티스레드로 돌고 있는 함수라면 의도치 않은 수정, 경쟁 상황 등의 염려가 있다
여러 스레드가 같은 객체 상태를 읽고 쓰면, 동기화를 제대로 하지 않는 한 레이스 컨디션, 더티 리드, 일관성 깨짐 등의 문제가 발생할 것이다
>> 레이스 컨디션
둘 이상의 스레드가 동시에 공유 자원을 읽거나 수정하면서, 실행 순서에 따라 결과가 달라지는 문제.
결과 = 실행 순서의 “경쟁”에 의해 결정됨 → 예측 불가.
✔️ 예시 (고전적인 예)
int count = 0;
Thread A: count++   // 1. load(0) → 2. +1 → 3. store(1)
Thread B: count++

처음 count=0일 때
A와 B가 거의 동시에 실행하면:

A: load 0
B: load 0
A: store 1
B: store 1 (A의 변경을 덮어써 버림)
➡️ 기대값 2 → 실제 결과는 1이 될 수 있다.
락이나 동기화를 추가하면 해결은 되지만, 성능 저하와 데드락 위험이 커진다


•  불변 객체와 가변 객체의 차이점과 각각의 장단점은 무엇인가요?
> 불변 객체는 멀티쓰레드 환경에서 안전하며, 전달 시 상태 변경 위험이 없어 설계상 권장된다. 
반면에 가변 객체는 멀티쓰레드 환경에서 수정이 가능하여 문제가 생길 수 있다.

가변의 장점
---
변경 비용이 저렴
메모리 효율적
JPA 같은 ORM에서 필수적
> 더티체크, 영속성 컨텍스트는 가변 객체가 기반/ 엔티티가 불변이면 JPA의 장점을 거의 못 쓴다.
---

가변의 단점
---
동시성 문제 발생
> 다중 스레드 환경에서는 synchronized 필요
예측하기 어려움
> 어디서 값이 변경되었는지 추적이 어렵다
---

불변 객체의 장점
---
동시성 안정
> synchronized 레이스 컨디션 발생하지 않는다
재사용성
> 불변 객체는 상태가 변하지 않으므로 여러 곳에서 동시에 재사용이 가능
가독성 향상
> 코드 분석이 단순화된다
객체의 일관성 보장
> 해당 객체를 사용하는 모든 부분에서 일관된 행동을 보장할 수 있다
보안성
> 외부에서 상태 변경이 불가능해서 악의적인 외부 공격으로부터 객체의 내부 상태를 보호하는데 유리하다
---

불변 객체의 단점
---
메모리 과도 사용
> 값 변경이 필요하면 비용이 증가한다. 즉 무언가를 바꾸려면 새 객체를 생성해야한다.
구현 복잡성 증가
> 모든 필드를 불변으로 유지하고, 내부 상태 변경하는 메서드는 제공하지않아야한
---




[인사이트 정리]
•  객체가 상태를 가질 때, 외부에서 세터를 통해 상태가 변경될 수 있어 추적이 어렵고 멀티스레드 환경에서 동기화 문제가 발생할 수 있다.
•  불변 객체는 멀티스레드 환경에서 안전하며, 전달 시 상태 변경 위험이 없어 설계상 권장된다.

[참고]
https://hijuu.tistory.com/36
https://youseong.tistory.com/63
